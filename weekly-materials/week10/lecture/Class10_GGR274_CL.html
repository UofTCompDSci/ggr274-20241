
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Class 10 &#8212; Computation and Data Science for Social Sciences</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'weekly-materials/week10/lecture/Class10_GGR274_CL';</script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="GGR274 Lab 10: Project data description and analysis" href="../lab/Lab_10.html" />
    <link rel="prev" title="GG274 Homework 9: Bootstrap Confidence Intervals" href="../../week09/homework/Homework_9.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../jupyter-book/index.html">
  
  
  
  
  
  
    <p class="title logo__title">Computation and Data Science for Social Sciences</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../jupyter-book/index.html">
                    👋 Course Website for GGR274H1-S Winter 2024
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Quick Links</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../syllabus/ggr274_syllabus.html">Course Syllabus</a></li>
<li class="toctree-l1"><a class="reference external" href="https://q.utoronto.ca/courses/338580/announcements">Announcements</a></li>
<li class="toctree-l1"><a class="reference external" href="https://piazza.com/utoronto.ca/winter2024/ggr274h1">Piazza</a></li>
<li class="toctree-l1"><a class="reference external" href="https://forms.office.com/Pages/ResponsePage.aspx?id=JsKqeAMvTUuQN7RtVsVSEF-wqptfr85NieT8UyliaxxUOUtMSVFUQkFTNVdRTlVJNkZFQU84NldYUi4u">Course Feedback Form</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../guides/jupyterhub_guide.html">JupyterHub Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/markus_guide.html">MarkUs Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://q.utoronto.ca/courses/338580/files?preview=29750629">Prof. Li's Slides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/lecture/Class1_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/lecture/Class1_GGR274_IM.html">Prof. Musabirov's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/lab/Lab_1.html">Lab 01 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/lab/Lab_1_solutions.html">Lab 01 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/homework/Homework_1.html">Homework 01 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/homework/Homework_1_solution.html">Homework 01 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week02/lecture/Class2_GGR274_DL_IM.html">Prof. Musabirov's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/lab/Lab_2.html">Lab 02 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/lab/Lab_2_solutions.html">Lab 02 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/homework/Homework_2.html">Homework 02 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/homework/Homework_2_solution.html">Homework 02 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week03/lecture/Class3_GGR274_DL_IM.html">Prof. Musabirov's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/lab/Lab_3.html">Lab 03 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/lab/Lab_3_solutions.html">Lab 03 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/homework/Homework_3.html">Homework 03 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/homework/Homework_3_solution.html">Homework 03 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://q.utoronto.ca/courses/338580/files?preview=30071956">Prof. Li's Slides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/lecture/Class4_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/lab/Lab_4.html">Lab 04 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/lab/Lab_4_solutions.html">Lab 04 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/homework/Homework_4.html">Homework 04 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/homework/marking/Homework_4_solution.html">Homework 04 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week05/lecture/Class5_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/lab/Lab_5.html">Lab 05 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/lab/Lab_5_solutions.html">Lab 05 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/homework/Homework_5.html">Homework 05 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/homework/marking/Homework_5_solution.html">Homework 05 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Practice Midterm</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../practice/sample_midterm/GGR274_Midterm.html">2022 Midterm Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../practice/review_w1-3.html">Review of frequent errors and extra examples for weeks 1-3</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Midterm</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../tests/midterm/Midterm.html">Midterm Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tests/midterm-makeup/Midterm_makeup.html">Midterm (makeup) Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Project</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../project/proposal/GGR274_Project_Proposal.html">Project Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project/presentation/GGR274_Final_Project_Instruction.html">Final Project Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project/presentation/extras/GGR274DSconfslides.html">Final Project Presentation Slides Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project/presentation/extras/Tipsandtricksforslides.html">Additional Tips and Tricks for Creating Slides in a Jupyter Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 7</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://q.utoronto.ca/courses/338580/files?preview=30627394">Prof. Li's Slides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week07/lecture/Class7_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week07/lab/Lab_7.html">Lab 07 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week07/lab/Lab_7_solutions.html">Lab 07 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week07/homework/Homework_7.html">Homework 07 Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 8</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week08/lecture/Class8_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/lab/Lab_8.html">Lab 08 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/homework/Homework_8.html">Homework 08 Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 9</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week09/lecture/Class9_GGR274_CL.html">Class 9</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../week09/lab/Lab_9.html">Lab 09 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week09/homework/Homework_9.html">Homework 09 Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 10</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Class 10</a></li>





<li class="toctree-l1"><a class="reference internal" href="../lab/Lab_10.html">Lab 10 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../homework/Homework_10.html">Homework 10 Notebook</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://jupyter.utoronto.ca/hub/user-redirect/git-pull?repo=https%3A//github.com/UofTCompDSci/ggr274-20241&urlpath=tree/ggr274-20241/weekly-materials/week10/lecture/Class10_GGR274_CL.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/weekly-materials/week10/lecture/Class10_GGR274_CL.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Class 10</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Class 10</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mar-19-2024">Mar. 19, 2024</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#review-of-linear-regression">Review of linear regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-effect-of-recent-immigration-on-asthma-rates-in-toronto-neighbourhoods">What is the effect of recent immigration on asthma rates in Toronto neighbourhoods?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sociodemographic-data">Sociodemographic data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#asthma-data">Asthma data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-sociodemographic-and-asthma-data">Merge Sociodemographic and asthma data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-regression-model-of-asthma-on-immigration">A regression model of asthma on immigration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-data">Plot the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-the-regression-model">Fit the regression model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-summary-of-the-regression-model">Statistical summary of the regression model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-regression-model-is-the-equation">The regression model is the equation:</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy-of-the-regression-model">Accuracy of the regression model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-and-testing-a-model">Training and testing a model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#splitting-a-pandas-dataframe-by-index">Splitting a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by <code class="docutils literal notranslate"><span class="pre">index</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-training-and-test-data-sets-from-a-single-dataset">Creating training and test data sets from a single dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1">Step 1:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-fit-the-regression-model-on-the-training-data">Step 2: Fit the regression model on the training data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-compute-fitted-values-using-training-data">Step 3: Compute fitted values using training data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-evaluate-accuracy-using-root-mean-squared-error-on-training-data">Step 4: Evaluate accuracy using root mean-squared error on training data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-evaluate-the-accuracy-of-regression-model-on-the-test-data-using-root-mean-squared-error">Step 5: Evaluate the accuracy of regression model on the test data using root mean-squared error</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-of-data-analysis-using-linear-regression-model">Conclusion of data analysis using linear regression model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#are-there-other-sociodemographic-factors-in-our-data-that-might-effect-asthma-rates">Are there other sociodemographic  factors in our data that might effect asthma rates?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-review-of-linear-regression">A quick review of linear regression</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-spatial-data">Introduction to spatial data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-spatial-data-matters">Why Spatial Data Matters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-spatial-data">What are spatial data?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-want-spatial-data">Why do we want spatial data?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-spatial-data">Types of Spatial Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raster-data-vector-data">raster data &amp; vector data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#raster-data">Raster data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#vector-data">Vector data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-are-these-data-stored-in-a-computer">How are these data stored in a computer?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generally-raster-data-are-stored-as-a-matrix">Generally raster data are stored as a matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#vector-data-is-stored-in-many-different-ways">Vector data is stored in many different ways…</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introducing-geopandas">Introducing GeoPandas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-work-with-spatial-data-in-python">How do we work with spatial data in python?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-want-to-import-a-spatial-data-file">Now we want to import a spatial data file.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#to-load-the-spatial-data-we-need-to-create-something-known-as-a-geodataframe">To load the spatial data we need to create something known as a geodataframe:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-if-we-want-to-make-a-map-what-do-we-do">Now if we want to make a map, what do we do?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#that-s-nice">That’s nice…</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-with-a-column-that-contains-a-number-what-happens-there">Let’s try with a column that contains a number… what happens there?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-again-with-neighbourhoods">let’s try again with neighbourhoods:</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#we-want-to-know-what-is-happening-inside-of-them">We want to know what is happening inside of them!</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-bring-data-from-a-table-into-a-geodataframe">How do we bring data from a table into a geodataframe?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-that-the-nbrhd-spat-id-in-neighborhood-geodataframe-is-string">Note that the <code class="docutils literal notranslate"><span class="pre">nbrhd_spat_id</span></code> in Neighborhood GeoDataFrame is string</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#now-let-s-do-the-join">Now let’s do the join!</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-that-we-have-merged-our-spatial-data-with-our-attribute-data">Now that we have merged our spatial data with our attribute data…</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#we-can-plot-the-values-using-the-geodataframe-maps-plotting-capability">we can plot the values using the geodataframe maps plotting capability</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hmm-looks-like-there-are-some-spatial-patterns">Hmm - Looks like there are some spatial patterns!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interesting">Interesting!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-dig-into-this-more-let-s-classify-the-data-using-quartiles">To dig into this more, let’s classify the data using quartiles…</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#first-steps-into-spatial-analysis">First steps into “spatial analysis”…</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-might-be-related-to-these-areas-with-higher-asthma">What might be related to these areas with higher asthma?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coordinate-systems-and-projections">Coordinate systems and projections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-that-our-two-geodataframe-spatial-layers-are-in-the-same-projection-we-can-plot-them-together">Now that our two geodataframe spatial layers are in the same projection, we can plot them together</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hmm-could-there-be-something-there">Hmm - could there be something there?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-do-a-spatial-join">Let’s do a “spatial join”</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#woah">Woah!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-check-this-new-no-duplicate-geodataframe-to-see-if-looks-right">Let’s check this new, no duplicate geodataframe to see if looks right.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-looks-good-based-on-visual-inspection">This looks good, based on visual inspection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-clean-things-up-a-little-and-create-the-final-geodataframe-we-want-to-work-with">Let’s clean things up a little and create the final geodataframe we want to work with</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="class-10">
<h1>Class 10<a class="headerlink" href="#class-10" title="Link to this heading">#</a></h1>
<section id="mar-19-2024">
<h2>Mar. 19, 2024<a class="headerlink" href="#mar-19-2024" title="Link to this heading">#</a></h2>
<p>By the end of this class, you’ll be able to:</p>
<ul class="simple">
<li><p>Fit linear regression;</p></li>
<li><p>Know what is spatial data;</p></li>
<li><p>Learn a new package geopandas;</p></li>
<li><p>Do some basic spatial analysis (we’ll learn more in next 2 weeks!)</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="review-of-linear-regression">
<h1>Review of linear regression<a class="headerlink" href="#review-of-linear-regression" title="Link to this heading">#</a></h1>
<section id="what-is-the-effect-of-recent-immigration-on-asthma-rates-in-toronto-neighbourhoods">
<h2>What is the effect of recent immigration on asthma rates in Toronto neighbourhoods?<a class="headerlink" href="#what-is-the-effect-of-recent-immigration-on-asthma-rates-in-toronto-neighbourhoods" title="Link to this heading">#</a></h2>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Data from <a class="reference external" href="http://torontohealthprofiles.ca">http://torontohealthprofiles.ca</a> contains data on asthma and immigration for each neighbourhood in Toronto.</p></li>
</ul>
<section id="sociodemographic-data">
<h4>Sociodemographic data<a class="headerlink" href="#sociodemographic-data" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Read sociodemographic data from the excel file <code class="docutils literal notranslate"><span class="pre">1_socdem_neighb_2006-2.xls</span></code> with sheet name <code class="docutils literal notranslate"><span class="pre">socdem_2006</span></code> into <code class="docutils literal notranslate"><span class="pre">pandas</span></code> using <code class="docutils literal notranslate"><span class="pre">read_excel</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;1_socdem_neighb_2006-2.xls&#39;</span>
<span class="n">sname</span> <span class="o">=</span> <span class="s1">&#39;socdem_2006&#39;</span>
<span class="n">socdem_neighb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sname</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="c1"># the table starts in row #11</span>
<span class="n">socdem_neighb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Which column should we select to measure immigration?  There are several choices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">socdem_neighb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s use <code class="docutils literal notranslate"><span class="pre">'%</span> <span class="pre">Recent</span> <span class="pre">immigrants-within</span> <span class="pre">5</span> <span class="pre">years'</span></code> to represent recent immigrants in a neighborhood.</p></li>
<li><p>Later on we will want a few more sociodemographic columns, so let’s create a new <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and rename the columns.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Neighbourhood id&#39;</span><span class="p">,</span> <span class="s1">&#39;Neighbourhood Name&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;Median household income after-tax $ ‡&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;% Rented Dwellings&#39;</span><span class="p">,</span> <span class="s1">&#39;% Unemployment rate *&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;% Recent immigrants-within 5 years&#39;</span><span class="p">,</span> <span class="s1">&#39;% Visible minority&#39;</span><span class="p">]</span>

<span class="n">socdem_neighb</span> <span class="o">=</span> <span class="n">socdem_neighb</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>

<span class="n">colnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;Neighbid&#39;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;median_income&#39;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;rented_dwell&#39;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;unemployment&#39;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;immigration5&#39;</span><span class="p">,</span>
            <span class="n">cols</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;vismin&#39;</span><span class="p">}</span>

<span class="n">socdem_neighb</span> <span class="o">=</span> <span class="n">socdem_neighb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">socdem_neighb</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">socdem_neighb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="asthma-data">
<h4>Asthma data<a class="headerlink" href="#asthma-data" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Read data from the excel file <code class="docutils literal notranslate"><span class="pre">1_ahd_neighb_db_ast_hbp_mhv_copd_2007.xls</span></code> with sheet name <code class="docutils literal notranslate"><span class="pre">1_ahd_neighb_asthma_2007</span></code> into <code class="docutils literal notranslate"><span class="pre">pandas</span></code> using <code class="docutils literal notranslate"><span class="pre">read_excel</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;1_ahd_neighb_db_ast_hbp_mhv_copd_2007.xls&#39;</span>
<span class="n">sname</span> <span class="o">=</span> <span class="s1">&#39;1_ahd_neighb_asthma_2007&#39;</span>

<span class="n">asthma_neighb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sname</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">11</span><span class="p">)</span> <span class="c1">#the table starts with row #12</span>
<span class="n">asthma_neighb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The asthma rates are broken down by sex and age.</p></li>
<li><p>Which rates should we choose?</p></li>
<li><p>For this example, let’s select asthma rates for both sexes age 20 - 64.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asthma_neighb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select the neghborhood_id, neighborhood_name, and both sexes with asthma</span>

<span class="n">important_cols</span> <span class="o">=</span> <span class="n">asthma_neighb</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">]]</span>

<span class="n">colnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">important_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s1">&#39;Neighbid&#39;</span><span class="p">,</span>
           <span class="n">important_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
           <span class="n">important_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">}</span>

<span class="n">asthma_rates</span> <span class="o">=</span> <span class="n">asthma_neighb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">asthma_rates</span> <span class="o">=</span> <span class="n">asthma_rates</span><span class="p">[</span><span class="n">important_cols</span><span class="p">]</span>

<span class="n">asthma_rates</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">asthma_rates</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="merge-sociodemographic-and-asthma-data">
<h3>Merge Sociodemographic and asthma data<a class="headerlink" href="#merge-sociodemographic-and-asthma-data" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>To examine the relationship between asthma and immigration we will need to merge <code class="docutils literal notranslate"><span class="pre">socdem_neighb</span></code> and <code class="docutils literal notranslate"><span class="pre">asthma_rates</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>s can be merged on neighbourhood id.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Two datasets are merged based on neighborhood id</span>

<span class="n">asthma_socdem</span> <span class="o">=</span> <span class="n">asthma_rates</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">socdem_neighb</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Neighbid&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Neighbid&#39;</span><span class="p">)</span>

<span class="n">asthma_socdem</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="a-regression-model-of-asthma-on-immigration">
<h2>A regression model of asthma on immigration<a class="headerlink" href="#a-regression-model-of-asthma-on-immigration" title="Link to this heading">#</a></h2>
<section id="plot-the-data">
<h3>Plot the data<a class="headerlink" href="#plot-the-data" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>What are the dependent and independent variables?</p></li>
<li><p>Does the relationship look linear?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;immigration5&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">asthma_socdem</span><span class="p">,</span> <span class="n">ci</span> <span class="o">=</span> <span class="kc">None</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Describe the relationship between asthma and immigration.</p>
</section>
<section id="fit-the-regression-model">
<h3>Fit the regression model<a class="headerlink" href="#fit-the-regression-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_asthmaimm</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;asthma_pct ~ immigration5&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">asthma_socdem</span><span class="p">)</span> <span class="c1"># setup the model</span>

<span class="n">reg_asthmaimm_fit</span> <span class="o">=</span> <span class="n">reg_asthmaimm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> <span class="c1"># estimate/fit the model </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="statistical-summary-of-the-regression-model">
<h3>Statistical summary of the regression model<a class="headerlink" href="#statistical-summary-of-the-regression-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_asthmaimm_summ</span> <span class="o">=</span> <span class="n">reg_asthmaimm_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">reg_asthmaimm_summ</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="the-regression-model-is-the-equation">
<h1>The regression model is the equation:<a class="headerlink" href="#the-regression-model-is-the-equation" title="Link to this heading">#</a></h1>
<div class="math notranslate nohighlight">
\[\texttt{asthma_pct} = 11.8266  - 0.1597 \times \texttt{immigration5}\]</div>
<ul class="simple">
<li><p>The <strong>slope</strong> indicates that for a 1% <strong>increase</strong> in immigration in the past 5 years the percentage of asthma cases in a neighbourhood <strong>decrease</strong> by 0.1597 (approximately 16%).</p></li>
<li><p>The <strong>y-intercept</strong> indicates that when a neighbourhood has 0% immigration the past 5 years then asthma rates are 11%.</p></li>
<li><p>Are there any neighbourhoods with 0% immigration in the past 5 years?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asthma_socdem</span><span class="p">[</span><span class="s1">&#39;immigration5&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The <strong>y-intercept</strong> in regression models often doesn’t have a sensible interpretation, but is often mathematically important for regression to work well.</p></li>
</ul>
<section id="accuracy-of-the-regression-model">
<h2>Accuracy of the regression model<a class="headerlink" href="#accuracy-of-the-regression-model" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_asthmaimm_fit</span><span class="o">.</span><span class="n">rsquared</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">reg_asthmaimm_fit</span><span class="o">.</span><span class="n">fittedvalues</span> <span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">reg_asthmaimm_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;fitted values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;residuals&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The R-squared statistics indicates a relatively good explanation of the model (quite larger than 0)</p></li>
<li><p>The residual plot indicates some important variables are missing, as we can see larger abolute values as fitted values increase (not a random distributed pattern)</p></li>
</ul>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h3>
<p>Therefore, we can conclude that the immigration rate in recent 5 years in a neighborhood is negatively associated with the prevalence of asthma in the neighborhood.</p>
<p>Why not causal relationship?</p>
<p>What is the implication?</p>
</section>
</section>
<section id="training-and-testing-a-model">
<h2>Training and testing a model<a class="headerlink" href="#training-and-testing-a-model" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Ideally we could assess the accuracy of this linear regression model on a new set of data (i.e., immigration rates in Toronto neighbourhoods in future years.)</p></li>
<li><p>But, we don’t have this data.</p></li>
<li><p>One trick that data scientists use to fit the model on part of the data (training data) and use the remaining part (testing data) to test the accuracy.</p></li>
<li><p>If we only have one data set then the training data can be obtained by randomly selecting rows from the data to fit the regression model, then the remaining rows can be used to test the accuracy of the model.</p></li>
</ul>
<section id="splitting-a-pandas-dataframe-by-index">
<h3>Splitting a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by <code class="docutils literal notranslate"><span class="pre">index</span></code><a class="headerlink" href="#splitting-a-pandas-dataframe-by-index" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]}</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<p>A Boolean array that is <code class="docutils literal notranslate"><span class="pre">True</span></code> if the index is <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>To create a Boolean series that is <code class="docutils literal notranslate"><span class="pre">False</span></code> if the index is <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">True</span></code> otherwise we can negate <code class="docutils literal notranslate"><span class="pre">df.index.isin([0,1])</span></code> this Boolean series using the <code class="docutils literal notranslate"><span class="pre">~</span></code> operator <code class="docutils literal notranslate"><span class="pre">~df.index.isin([0,1])</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-training-and-test-data-sets-from-a-single-dataset">
<h3>Creating training and test data sets from a single dataset<a class="headerlink" href="#creating-training-and-test-data-sets-from-a-single-dataset" title="Link to this heading">#</a></h3>
</section>
<section id="step-1">
<h3>Step 1:<a class="headerlink" href="#step-1" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>split the data into a training set with 75% of the rows.</p></li>
<li><p>use the remaining 25% of the data for testing.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># for reproducibility</span>

<span class="c1"># randomly select 75% of neighbourhoods</span>
<span class="n">reg_df_train</span> <span class="o">=</span> <span class="n">asthma_socdem</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> 

<span class="c1"># get index of training data</span>
<span class="n">train_index</span> <span class="o">=</span> <span class="n">reg_df_train</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Exclude indicies from <code class="docutils literal notranslate"><span class="pre">reg_df_train</span></code> using <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">isin</span></code> function.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exclude rows in training to define test data</span>
<span class="n">reg_df_test</span> <span class="o">=</span> <span class="n">asthma_socdem</span><span class="p">[</span><span class="o">~</span><span class="n">asthma_socdem</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_index</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">asthma_socdem</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">reg_df_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">reg_df_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-fit-the-regression-model-on-the-training-data">
<h3>Step 2: Fit the regression model on the training data<a class="headerlink" href="#step-2-fit-the-regression-model-on-the-training-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_train</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;asthma_pct ~ immigration5&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">reg_df_train</span><span class="p">)</span> <span class="c1"># setup the model</span>

<span class="n">reg_train_fit</span> <span class="o">=</span> <span class="n">reg_train</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> <span class="c1"># estimate/fit the model </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-3-compute-fitted-values-using-training-data">
<h3>Step 3: Compute fitted values using training data<a class="headerlink" href="#step-3-compute-fitted-values-using-training-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use the model fit on the training data to predict asthma rates</span>
<span class="c1"># from the test set. </span>

<span class="n">predvalues_train</span> <span class="o">=</span> <span class="n">reg_train_fit</span><span class="o">.</span><span class="n">fittedvalues</span>

<span class="c1"># Another way to compute</span>
<span class="c1"># predvalues_train = reg_train_fit.predict(reg_df_train[&#39;immigration5&#39;])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-4-evaluate-accuracy-using-root-mean-squared-error-on-training-data">
<h3>Step 4: Evaluate accuracy using root mean-squared error on training data<a class="headerlink" href="#step-4-evaluate-accuracy-using-root-mean-squared-error-on-training-data" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Another measure of accuracy of regression models.</p></li>
<li><p>Compares observed values of the dependent variable with the predicted values.</p></li>
</ul>
<p><img alt="rmse.jpg" src="../../../_images/insights_rmse_formula1.jpg" /></p>
<p>It can be computed using the <code class="docutils literal notranslate"><span class="pre">rmse</span></code> function from <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute root mean-squared error for the training data.</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.eval_measures</span> <span class="kn">import</span> <span class="n">rmse</span>

<span class="n">rmse</span><span class="p">(</span><span class="n">predvalues_train</span><span class="p">,</span> <span class="n">reg_df_train</span><span class="p">[</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The observed asthma rates deviate from the predicted asthma rates in each neighbourhood by 1.4% in the training set.</p></li>
<li><p>Is this an acceptable prediction error?</p></li>
<li><p>Let’s examine the accuracy of the linear regression model on the test set</p></li>
</ul>
</section>
<section id="step-5-evaluate-the-accuracy-of-regression-model-on-the-test-data-using-root-mean-squared-error">
<h3>Step 5: Evaluate the accuracy of regression model on the test data using root mean-squared error<a class="headerlink" href="#step-5-evaluate-the-accuracy-of-regression-model-on-the-test-data-using-root-mean-squared-error" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Compute predictions using test data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predvalues_test</span> <span class="o">=</span> <span class="n">reg_train_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">reg_df_test</span><span class="p">[</span><span class="s1">&#39;immigration5&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Now compute the root mean-squared error for the test data using the model fit on the training data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmse</span><span class="p">(</span><span class="n">predvalues_test</span><span class="p">,</span> <span class="n">reg_df_test</span><span class="p">[</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion-of-data-analysis-using-linear-regression-model">
<h2>Conclusion of data analysis using linear regression model<a class="headerlink" href="#conclusion-of-data-analysis-using-linear-regression-model" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>The regression model appears to provide an accurate fit the data, although both the scatter plot and plot of residuals indicate that there is a lot of variation in asthma rates in neighbourhoods when the immigrations rates are small (between 10%-20%).</p></li>
<li><p>As the percentage of immigrants to a neighbourhood within the last 5 years increases, the asthma rates will decreases.</p></li>
<li><p>Regression analyses on aggregated data such as neighbourhoods can be misleading when compared to non-aggregated data.</p></li>
</ul>
</section>
<section id="are-there-other-sociodemographic-factors-in-our-data-that-might-effect-asthma-rates">
<h2>Are there other sociodemographic  factors in our data that might effect asthma rates?<a class="headerlink" href="#are-there-other-sociodemographic-factors-in-our-data-that-might-effect-asthma-rates" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Let’s create a matrix scatter plot using <a class="reference external" href="https://seaborn.pydata.org/generated/seaborn.pairplot.html"><code class="docutils literal notranslate"><span class="pre">pairplot</span></code></a> in the <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pairplot</span></code> will visualize paired relationship between variables in a dataset.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asthma_socdem</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reduce the column for better presentation</span>
<span class="n">to_show</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span><span class="s1">&#39;rented_dwell&#39;</span><span class="p">,</span><span class="s1">&#39;immigration5&#39;</span><span class="p">,</span><span class="s1">&#39;vismin&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">asthma_socdem</span><span class="p">[</span><span class="n">to_show</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Let’s consider median income</p></li>
<li><p>Fit the regression model on all the data and produce a statistical summary.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_asthmaimmunem</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;asthma_pct ~ immigration5 + median_income&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">asthma_socdem</span><span class="p">)</span> <span class="c1"># setup the model</span>

<span class="n">reg_asthmaimmunem_fit</span> <span class="o">=</span> <span class="n">reg_asthmaimmunem</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span> <span class="c1"># estimate/fit the model </span>

<span class="n">reg_asthmaimmunem_summ</span> <span class="o">=</span> <span class="n">reg_asthmaimmunem_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="n">reg_asthmaimmunem_summ</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Notice that the slope estimate (coefficient) for <code class="docutils literal notranslate"><span class="pre">median_income</span></code> is 0, but so is the p-value and range of plausible values.</p></li>
<li><p>That seems odd.  What’s happening?</p></li>
<li><p>We can see from the scatter plot that <code class="docutils literal notranslate"><span class="pre">immigration5</span></code> and <code class="docutils literal notranslate"><span class="pre">median_income</span></code> have a linear relationship.</p></li>
<li><p>When two variables have a linear relationship multiple linear regression models produce strange results.</p></li>
<li><p>It’s important that independent variables in a multiple regression model are unrelated.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;immigration5&#39;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">asthma_socdem</span><span class="p">,</span> <span class="n">ci</span> <span class="o">=</span> <span class="kc">None</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-quick-review-of-linear-regression">
<h2>A quick review of linear regression<a class="headerlink" href="#a-quick-review-of-linear-regression" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Step 1: prepare data (Which dataset I want to import? Which variables I want to analyze? How I can ‘wrangle’ the data, i.e., produce new variables and merge them into one dataframe for further analysis?)</p></li>
<li><p>Step 2: Explore pair relationship (Using <code class="docutils literal notranslate"><span class="pre">sns.pairplot</span></code> to explore potential relationships. Is there a linear relationship?)</p></li>
<li><p>Step 3: Fit model</p></li>
<li><p>Step 4: Accuracy (Which indicators I want to use? e.g., r-squared, residual plot, RMSE)</p></li>
<li><p>Step 5: Display the full model and explain (What does the model mean?)</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-to-spatial-data">
<h1>Introduction to spatial data<a class="headerlink" href="#introduction-to-spatial-data" title="Link to this heading">#</a></h1>
<section id="why-spatial-data-matters">
<h2>Why Spatial Data Matters<a class="headerlink" href="#why-spatial-data-matters" title="Link to this heading">#</a></h2>
<section id="what-are-spatial-data">
<h3>What are spatial data?<a class="headerlink" href="#what-are-spatial-data" title="Link to this heading">#</a></h3>
<p>Spatial data are data that have some geographic attribute(s). So you can think of it like each row having a pointer to where the row goes on a map.</p>
</section>
<section id="why-do-we-want-spatial-data">
<h3>Why do we want spatial data?<a class="headerlink" href="#why-do-we-want-spatial-data" title="Link to this heading">#</a></h3>
<p>By locating things on a map, we can look for how certain variables present vary across space. We can look for things like clustering of high values or cold spots (aka hot spots/cold spots) or dispersal. Patterns across space can reveal interesting drivers of social phenomena.</p>
<p><img alt="toronto income" src="https://preview.redd.it/xisicselj7t21.jpg?width=960&amp;crop=smart&amp;auto=webp&amp;s=541f2d6a7f83deea324230f885831c8a84b2cb45" /></p>
</section>
</section>
<section id="types-of-spatial-data">
<h2>Types of Spatial Data<a class="headerlink" href="#types-of-spatial-data" title="Link to this heading">#</a></h2>
<section id="raster-data-vector-data">
<h3>raster data &amp; vector data<a class="headerlink" href="#raster-data-vector-data" title="Link to this heading">#</a></h3>
<p><img alt="vector and raster" src="https://cdn.safe.com/wp-content/uploads/2021/10/13090609/Raster-VS-Vector-1.png" /></p>
<section id="raster-data">
<h4>Raster data<a class="headerlink" href="#raster-data" title="Link to this heading">#</a></h4>
<p>For example, satellite and aerial images</p>
<p><img alt="landsat data" src="https://upload.wikimedia.org/wikipedia/commons/b/bf/Toronto_Landsat.jpg" /></p>
</section>
<section id="vector-data">
<h4>Vector data<a class="headerlink" href="#vector-data" title="Link to this heading">#</a></h4>
<p>For example, points, lines, and polygons</p>
<p><img alt="points lines polys" src="https://community.alteryx.com/t5/image/serverpage/image-id/49570i26EF3FAEACD21BD4/image-size/medium?v=1.0&amp;px=400" /></p>
</section>
</section>
</section>
<section id="how-are-these-data-stored-in-a-computer">
<h2>How are these data stored in a computer?<a class="headerlink" href="#how-are-these-data-stored-in-a-computer" title="Link to this heading">#</a></h2>
<p>There are many ways!</p>
<section id="generally-raster-data-are-stored-as-a-matrix">
<h3>Generally raster data are stored as a matrix<a class="headerlink" href="#generally-raster-data-are-stored-as-a-matrix" title="Link to this heading">#</a></h3>
<p><img alt="matrix raster" src="https://www.researchgate.net/profile/Bartosz-Mitka-2/publication/269336365/figure/fig1/AS:650423912374277&#64;1532084553146/The-matrix-of-Regular-Raster-Grid-model-containing-elevations-of-terrain-Elevations-of.png" /></p>
</section>
<section id="vector-data-is-stored-in-many-different-ways">
<h3>Vector data is stored in many different ways…<a class="headerlink" href="#vector-data-is-stored-in-many-different-ways" title="Link to this heading">#</a></h3>
<p>Two common ones are <code class="docutils literal notranslate"><span class="pre">geojson</span></code> and <code class="docutils literal notranslate"><span class="pre">shapefiles</span></code>.</p>
<p>What are these files made of?</p>
<p>Geojson is pretty straightforward:</p>
<p><img alt="geojson example" src="http://djjr-courses.wdfiles.com/local--files/soc128:images-coding/GEOJSON-format01.png" /></p>
<p>Shapefiles are more complicated and involve multiple distinct files that contain information about spatial locations, coordinate systems and projections, attributes, etc. We’ll focus on geojson for this class.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introducing-geopandas">
<h1>Introducing GeoPandas<a class="headerlink" href="#introducing-geopandas" title="Link to this heading">#</a></h1>
<section id="how-do-we-work-with-spatial-data-in-python">
<h2>How do we work with spatial data in python?<a class="headerlink" href="#how-do-we-work-with-spatial-data-in-python" title="Link to this heading">#</a></h2>
<p>We’re going to use something called ‘geopandas’</p>
<p><a class="reference external" href="https://geopandas.org/en/stable/">https://geopandas.org/en/stable/</a></p>
<p>There are a few other libraries that we need, like mapclassify. There are a lot of different tools out there, but we’ll stick to these two (and the xls reader) for today</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Let&#39;s install and then load libraries</span>
<span class="c1"># import sys</span>
<span class="c1"># !{sys.executable} -m pip install geopandas</span>
<span class="c1"># !{sys.executable} -m pip install mapclassify</span>
<span class="c1"># !{sys.executable} -m pip install xlrd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mapclassify</span>
<span class="kn">import</span> <span class="nn">xlrd</span>
</pre></div>
</div>
</div>
</div>
<section id="now-we-want-to-import-a-spatial-data-file">
<h3>Now we want to import a spatial data file.<a class="headerlink" href="#now-we-want-to-import-a-spatial-data-file" title="Link to this heading">#</a></h3>
<p>We’ll be working with two spatial data files today:
<code class="docutils literal notranslate"><span class="pre">Toronto_Neighbourhoods.geojson</span></code> and <code class="docutils literal notranslate"><span class="pre">toronto_rails.geojson</span></code></p>
<p>We’ll also use the health data we were playing with last week:
<code class="docutils literal notranslate"><span class="pre">1_ahd_neighb_db_ast_hbp_mhv_copd_2007.xls</span></code></p>
<section id="to-load-the-spatial-data-we-need-to-create-something-known-as-a-geodataframe">
<h4>To load the spatial data we need to create something known as a geodataframe:<a class="headerlink" href="#to-load-the-spatial-data-we-need-to-create-something-known-as-a-geodataframe" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;Toronto_Neighbourhoods.geojson&quot;</span><span class="p">)</span> <span class="c1">## Like pd.read_xxx(file_name)</span>
<span class="n">nbrhd</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s look at the geometry column - this is the data that </span>
<span class="c1"># describes the polygon representing the first neighbourhood</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nbrhd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Otherwise we can continue to treat the variable like a dataframe ... </span>
<span class="c1"># it&#39;s what we have been doing all along!</span>

<span class="n">nbrhd_names</span> <span class="o">=</span> <span class="n">nbrhd</span><span class="p">[</span><span class="s2">&quot;AREA_NAME&quot;</span><span class="p">]</span>
<span class="nb">type</span><span class="p">(</span><span class="n">nbrhd_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="now-if-we-want-to-make-a-map-what-do-we-do">
<h3>Now if we want to make a map, what do we do?<a class="headerlink" href="#now-if-we-want-to-make-a-map-what-do-we-do" title="Link to this heading">#</a></h3>
<p>It’s easy! You can “plot” a geodataframe and geopandas will make it a map!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="that-s-nice">
<h3>That’s nice…<a class="headerlink" href="#that-s-nice" title="Link to this heading">#</a></h3>
<p>But we want to be a little more sophisticated with our maps.</p>
<p><img alt="basic_gif" src="../../../_images/basic.gif" /></p>
<p>The next cell goes through a better way to create a map “figure”.</p>
<p>Let’s first create <code class="docutils literal notranslate"><span class="pre">Figure</span></code> and <code class="docutils literal notranslate"><span class="pre">Axes</span></code> objects.</p>
<p><img alt="fig and ax" src="../../../_images/matplotlib_figure_axes_axis.png" /></p>
<p>First, let’s use <code class="docutils literal notranslate"><span class="pre">plt.subplots</span></code> to create a figure variable “fig” and an axes variables called “ax”.</p>
<p>The first line of code sets the stage - it says how many images - by rows/columns, and we can set other figure attributes in here, like figure size using figsize.</p>
<p>To plot the map, we need to call the plot command <code class="docutils literal notranslate"><span class="pre">.plot</span></code> like before, but this time we want to say which ‘cell’ or ax cell it will go in, i.e., <code class="docutils literal notranslate"><span class="pre">ax=axes</span></code>. We also can use the <code class="docutils literal notranslate"><span class="pre">column</span></code> parameter to shade each row (that represents a polygon) by an attribute value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fig</span><span class="p">))</span> <span class="c1">#Figure object is like the sheet we are drawing on</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>  <span class="c1">#AxesSubplots are like cells within the sheet</span>

<span class="n">nbrhd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;AREA_NAME&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>What if we want to do 2 maps in one figure?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1">#notice there are just 2 things in the axes object</span>
<span class="nb">print</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># pick the first cell in the figure</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">nbrhd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;AREA_NAME&quot;</span><span class="p">,</span>
           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># pick the second cell in the figure</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">nbrhd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1">#resize</span>
<span class="n">current_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span> <span class="c1">#get current figure aka gcf</span>
<span class="n">current_fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="c1">#set figure width</span>
<span class="n">current_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;torontomaps.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> <span class="c1">#export maps as an image file!</span>
</pre></div>
</div>
</div>
</div>
<p>A note about axes:</p>
<ul class="simple">
<li><p>if you only has one ‘axes’ (i.e., plt.subplots(1,1)) then you can just say <code class="docutils literal notranslate"><span class="pre">ax</span> <span class="pre">=</span> <span class="pre">axes</span></code></p></li>
<li><p>if you have a 1 row and multiple columns or multiple rows and 1 column, then you would say <code class="docutils literal notranslate"><span class="pre">ax</span> <span class="pre">=</span> <span class="pre">axes[n]</span></code> where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the axes cell you’d like to put the figure in</p></li>
<li><p>if you have a matrix of cells of axes (i.e., plt.subplots(2,2)) then you need to say <code class="docutils literal notranslate"><span class="pre">ax</span> <span class="pre">=</span> <span class="pre">axes[n][m]</span></code> where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the row number and <code class="docutils literal notranslate"><span class="pre">m</span></code> is the column number of the cell</p></li>
</ul>
<section id="let-s-try-with-a-column-that-contains-a-number-what-happens-there">
<h4>Let’s try with a column that contains a number… what happens there?<a class="headerlink" href="#let-s-try-with-a-column-that-contains-a-number-what-happens-there" title="Link to this heading">#</a></h4>
<p>let’s also add a new parameter “cmap” = <a class="reference external" href="https://matplotlib.org/stable/tutorials/colors/colormaps.html">color map</a> and a legend.</p>
<p>This link will provide more info on other things we can do with plotting geodataframes:
<a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html">https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># We want to plot the area of each neighborhood</span>
<span class="n">nbrhd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;Shape__Area&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span> 
           <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;cool&quot;</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">current_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">current_fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="let-s-try-again-with-neighbourhoods">
<h3>let’s try again with neighbourhoods:<a class="headerlink" href="#let-s-try-again-with-neighbourhoods" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#another way to resize</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>


<span class="n">nbrhd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;AREA_NAME&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span>
           <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Pastel1&quot;</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>… These are silly maps. Who cares how big the neighbourhoods are or who can deal with a weird pastel map with a legend that is way too big…</p>
<section id="we-want-to-know-what-is-happening-inside-of-them">
<h4>We want to know what is happening inside of them!<a class="headerlink" href="#we-want-to-know-what-is-happening-inside-of-them" title="Link to this heading">#</a></h4>
<p>How do we bring two pieces of info together? How do we bring data from a table into a geodataframe?</p>
<p>We can use joins! Remember those?</p>
</section>
</section>
<section id="how-do-we-bring-data-from-a-table-into-a-geodataframe">
<h3>How do we bring data from a table into a geodataframe?<a class="headerlink" href="#how-do-we-bring-data-from-a-table-into-a-geodataframe" title="Link to this heading">#</a></h3>
<p>We can use <code class="docutils literal notranslate"><span class="pre">merge</span></code>, just like what we did before!</p>
<p>Let’s join the asthma rates into the neighborhood and map them out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simplify the geodataframe ready</span>

<span class="n">important_spat_cols</span> <span class="o">=</span> <span class="n">nbrhd</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">17</span><span class="p">]]</span>
<span class="n">colnames_spat</span> <span class="o">=</span> <span class="p">{</span><span class="n">important_spat_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
           <span class="n">important_spat_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;nbrhd_spat_id&#39;</span><span class="p">,</span>
           <span class="n">important_spat_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;geometry&#39;</span><span class="p">}</span>

<span class="n">nbrhd_simple</span> <span class="o">=</span> <span class="n">nbrhd</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">nbrhd_simple</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="p">[</span><span class="n">important_spat_cols</span><span class="p">]</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames_spat</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Notice that the &quot;nbrhd_spat_id&quot; is a string and not a number... that may be an issue</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The data type of nbrhd_spat_id is: &quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">nbrhd_simple</span><span class="p">[</span><span class="s2">&quot;nbrhd_spat_id&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#get the asthma data</span>

<span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;1_ahd_neighb_db_ast_hbp_mhv_copd_2007.xls&#39;</span> <span class="c1">#file name</span>
<span class="n">sname</span> <span class="o">=</span> <span class="s1">&#39;1_ahd_neighb_asthma_2007&#39;</span> <span class="c1">#sheet name in excel file</span>

<span class="c1">#store excel sheet with asthma data in a dataframe variable</span>
<span class="n">asthma_neighb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sname</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">asthma_neighb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#let&#39;s simplify this by only pulling a few relevant columns</span>
<span class="n">important_cols</span> <span class="o">=</span> <span class="n">asthma_neighb</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">]]</span>
<span class="n">colnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">important_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s1">&#39;Neighbid&#39;</span><span class="p">,</span>
           <span class="n">important_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
           <span class="n">important_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">}</span>

<span class="n">asthma_rates</span> <span class="o">=</span> <span class="n">asthma_neighb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">asthma_rates</span> <span class="o">=</span> <span class="n">asthma_rates</span><span class="p">[</span><span class="n">important_cols</span><span class="p">]</span>

<span class="n">asthma_rates</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The data type of Neighbid is: &quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">asthma_rates</span><span class="p">[</span><span class="s2">&quot;Neighbid&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">asthma_rates</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="note-that-the-nbrhd-spat-id-in-neighborhood-geodataframe-is-string">
<h3>Note that the <code class="docutils literal notranslate"><span class="pre">nbrhd_spat_id</span></code> in Neighborhood GeoDataFrame is string<a class="headerlink" href="#note-that-the-nbrhd-spat-id-in-neighborhood-geodataframe-is-string" title="Link to this heading">#</a></h3>
<p>Let’s convert it into a number.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new variable in the nbrhd_simple geodataframe and store the new number</span>
<span class="c1"># version of the neighbourhood id here</span>
<span class="n">nbrhd_simple</span><span class="p">[</span><span class="s2">&quot;Neighbid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="p">[</span><span class="s2">&quot;nbrhd_spat_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># we can sort by the id - and check to see if they line up with the asthma data </span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Neighbid&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="now-let-s-do-the-join">
<h4>Now let’s do the join!<a class="headerlink" href="#now-let-s-do-the-join" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd_simple</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">asthma_rates</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Neighbid&quot;</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="now-that-we-have-merged-our-spatial-data-with-our-attribute-data">
<h3>Now that we have merged our spatial data with our attribute data…<a class="headerlink" href="#now-that-we-have-merged-our-spatial-data-with-our-attribute-data" title="Link to this heading">#</a></h3>
<section id="we-can-plot-the-values-using-the-geodataframe-maps-plotting-capability">
<h4>we can plot the values using the geodataframe maps plotting capability<a class="headerlink" href="#we-can-plot-the-values-using-the-geodataframe-maps-plotting-capability" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#generate our figure/axes and set fig size</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="c1">#let&#39;s map asthma percent rates across toronto!</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;asthma_pct&quot;</span><span class="p">,</span>
                  <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span> 
                  <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;YlOrRd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="hmm-looks-like-there-are-some-spatial-patterns">
<h3>Hmm - Looks like there are some spatial patterns!<a class="headerlink" href="#hmm-looks-like-there-are-some-spatial-patterns" title="Link to this heading">#</a></h3>
<p>We can also look at non-spatial figures to explore our data. Doing this helps us understand the ‘shape’ of our data in different ways.</p>
<p>Let’s create a histogram of the same data in the following cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Just like what we do in pandas</span>
<span class="n">nbrhd_simple</span><span class="p">[</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Asthma Percent&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of neighbourhoods&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of percent of residents with asthma in Toronto, ON&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="interesting">
<h3>Interesting!<a class="headerlink" href="#interesting" title="Link to this heading">#</a></h3>
<p>This looks like a “normal” distribution:</p>
<ul class="simple">
<li><p>Many neighbourhoods with values in the middle range, but some at the extremes (both low and high).</p></li>
</ul>
<p>But when we look at the map, we notice that neighbourhoods with high values tend to be near other neighbourhoods with high values, and low value neighbourhoods near others with low values.</p>
<p>Maybe there is some spatial mechanism causing this!</p>
</section>
<section id="to-dig-into-this-more-let-s-classify-the-data-using-quartiles">
<h3>To dig into this more, let’s classify the data using quartiles…<a class="headerlink" href="#to-dig-into-this-more-let-s-classify-the-data-using-quartiles" title="Link to this heading">#</a></h3>
<p>To do this we add a <code class="docutils literal notranslate"><span class="pre">scheme</span></code> parameter to the plot function and use <code class="docutils literal notranslate"><span class="pre">quantiles</span></code>. the <code class="docutils literal notranslate"><span class="pre">k</span></code> value tells the plot function how many quantiles you want. We want four quantiles (0-25%, 25%-50%, 50%-75%, 75%-100%).</p>
<p>More information about <a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html"><code class="docutils literal notranslate"><span class="pre">plot</span></code></a> function</p>
<p>We do this for a few reasons:</p>
<ul class="simple">
<li><p>(1) It makes it easier to see groups with similar values that are close to eachother and</p></li>
<li><p>(2) it makes the legend easier to interpret.</p></li>
</ul>
<p>Note that we also have added an <code class="docutils literal notranslate"><span class="pre">edgecolor</span></code> parameter which tells the map what color to outline neighbourhoods with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                  <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This map looks a lot better, I think! But the legend is overlapping the map. We should move it.</p>
<p>The legend options are kind of complicated, but you can find more about stuff here: <a class="reference external" href="https://matplotlib.org/3.5.1/api/_as_gen/matplotlib.pyplot.legend.html">https://matplotlib.org/3.5.1/api/_as_gen/matplotlib.pyplot.legend.html</a></p>
<p>I’m going to show you a few things you can do, like move the legend, adjust font size, and add a title:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> 
                  <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span> <span class="c1">#&#39;loc&#39;=4 means lower right</span>
</pre></div>
</div>
</div>
</div>
<p>Can we show descriptive stats charts next to a map?</p>
<p>Yes!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#First create a figure sheet with 2 axes cells (and resize the figure)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1">#let&#39;s put the map in the first axes cell:</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="c1">#notice I added linewidth to narrow the borders</span>
                  <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">})</span>

<span class="c1">#we can put the histogram we made earlier in the second axes cell:</span>
<span class="n">nbrhd_simple</span><span class="p">[</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Asthma Percent&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of neighbourhoods&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of percent of residents with asthma in Toronto, ON&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="first-steps-into-spatial-analysis">
<h1>First steps into “spatial analysis”…<a class="headerlink" href="#first-steps-into-spatial-analysis" title="Link to this heading">#</a></h1>
<p>OK great! That chart is interesting and gets us thinking. But one of the powers of spatial analysis is relating environments to spatial phenomena.</p>
<section id="what-might-be-related-to-these-areas-with-higher-asthma">
<h2>What might be related to these areas with higher asthma?<a class="headerlink" href="#what-might-be-related-to-these-areas-with-higher-asthma" title="Link to this heading">#</a></h2>
<p>Let’s make a map with multiple layers of info…</p>
<p>To do this, we need a second spatial data file. We know there is research that relates asthma to being near railroads. Let’s see if being near a railway in Toronto is associated to patterns of asthma.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#first we need to bring in the spatial data on railroads in the Toronto area</span>

<span class="n">railways</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;toronto_rails.geojson&quot;</span><span class="p">)</span>
<span class="n">railways</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="coordinate-systems-and-projections">
<h2>Coordinate systems and projections<a class="headerlink" href="#coordinate-systems-and-projections" title="Link to this heading">#</a></h2>
<p>When working with spatial data, you may need to think about coordinate systems and geographic projections.</p>
<p>Because we are taking data that exist on a sphere and laying them out flat on a plane, all spatial data is projected.</p>
<p><img alt="projections" src="https://cdn-images-1.medium.com/fit/t/1600/480/1*H96H7Gn9EcfZH5tEmMoSXg.gif" /></p>
<p>If you have two layers of spatial data it is always good to check that they are in the same projection, or else you will get errors or bad results.</p>
<p>If the files are not in the same projection, it’s pretty simple to convert one of the files to the same projection as the other file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># double check coordinate systems - we always want to work in the same projection</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The original projection of railways is: &quot;</span><span class="p">,</span> <span class="n">railways</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The original projection of nbrhd_simple is: &quot;</span><span class="p">,</span> <span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="c1"># reproject railways so it&#39;s the same as our neighbourhood layer</span>
<span class="n">railways</span> <span class="o">=</span> <span class="n">railways</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span> <span class="c1">#we can just borrow the &quot;crs&quot; (coordinate reference system) from the other spatial file</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The NEW projection of railways is: &quot;</span><span class="p">,</span> <span class="n">railways</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;And nbrhd_simple is still: &quot;</span><span class="p">,</span> <span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="n">railways</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="now-that-our-two-geodataframe-spatial-layers-are-in-the-same-projection-we-can-plot-them-together">
<h2>Now that our two geodataframe spatial layers are in the same projection, we can plot them together<a class="headerlink" href="#now-that-our-two-geodataframe-spatial-layers-are-in-the-same-projection-we-can-plot-them-together" title="Link to this heading">#</a></h2>
<p>We want to create 1 map and tell geopandas to put the two spatial layers in the same axes cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                  <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>

<span class="n">railways</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">)</span> <span class="c1">#notice i&#39;m putting this in the same axes cell</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="hmm-could-there-be-something-there">
<h2>Hmm - could there be something there?<a class="headerlink" href="#hmm-could-there-be-something-there" title="Link to this heading">#</a></h2>
<p>Maybe!</p>
<p>But what are the things that might be happening here?</p>
</section>
<section id="let-s-do-a-spatial-join">
<h2>Let’s do a “spatial join”<a class="headerlink" href="#let-s-do-a-spatial-join" title="Link to this heading">#</a></h2>
<p>What is a spatial join?</p>
<p><img alt="alt text" src="https://web.natur.cuni.cz/~langhamr/lectures/vtfg1/mapinfo_1/about_gis/Image23.gif" /></p>
<p>Basically, we are relating information from two tables that share a spatial relationship.</p>
<p>So information from layer a’s table will be joined with information from layer b’s table where the two intersect/touch/are within/etc.</p>
<p>We will use “intersect” here, but you can refer to the geopandas documentation to learn more:</p>
<p><a class="reference external" href="https://geopandas.org/en/stable/gallery/spatial_joins.html">https://geopandas.org/en/stable/gallery/spatial_joins.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">join_left_df</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">railways</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">predicate</span> <span class="o">=</span> <span class="s2">&quot;intersects&quot;</span><span class="p">)</span>
<span class="n">join_left_df</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="woah">
<h2>Woah!<a class="headerlink" href="#woah" title="Link to this heading">#</a></h2>
<p>Now we have 2528 rows… that’s way more rows than neighbourhoods. What happened?</p>
<p>Spatial join creates a new row for every instance of ‘intersection’. So if railway 1 and railway 2 both go through neighbourhood a, then there will be two rows with neighbourhood a with one row joined with railway a data and the other joined with railway b data.</p>
<p>Also, notice that neighbourhoods that didn’t have any railway go through them were appended with NaNs. This is saying there is no data about railways for these neighbourhoods because there were none there.</p>
<p>Because we just want to know what neighbourhoods have <em>ANY</em> railway go through them, we can take the joined results and remove duplicate rows of each neighbourhood.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_duplicates_gdf</span> <span class="o">=</span> <span class="n">join_left_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">no_duplicates_gdf</span> <span class="o">=</span> <span class="n">no_duplicates_gdf</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s1">&#39;Neighbid&#39;</span><span class="p">)</span>
<span class="n">no_duplicates_gdf</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<section id="let-s-check-this-new-no-duplicate-geodataframe-to-see-if-looks-right">
<h3>Let’s check this new, no duplicate geodataframe to see if looks right.<a class="headerlink" href="#let-s-check-this-new-no-duplicate-geodataframe-to-see-if-looks-right" title="Link to this heading">#</a></h3>
<p>We can plot the map using “index_right” which is the index from the railway layer. The values are meaningless, but it shows us where there ARE values and where there are not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_duplicates_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;index_right&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="this-looks-good-based-on-visual-inspection">
<h3>This looks good, based on visual inspection<a class="headerlink" href="#this-looks-good-based-on-visual-inspection" title="Link to this heading">#</a></h3>
<p>But we need a column that tells us there IS or there IS NOT a railway in each neighbourhood. We can go back to some of the skills we learned earlier in the course to do this.</p>
<p>We will first create two series of TRUE and FALSE values to show where a value exists in the “index_right” column.</p>
<p>The series <code class="docutils literal notranslate"><span class="pre">rail_present</span></code> will be true if there is a value in the column - implying a railway goes through the neighbourhood, and false otherwise.</p>
<p>The series <code class="docutils literal notranslate"><span class="pre">rail_not_present</span></code> will be true if there is a NaN value in the row where the railway info is, and false otherwise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rail_present</span> <span class="o">=</span> <span class="n">no_duplicates_gdf</span><span class="p">[</span><span class="s2">&quot;index_right&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
<span class="n">rail_present</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rail_not_present</span> <span class="o">=</span> <span class="n">no_duplicates_gdf</span><span class="p">[</span><span class="s2">&quot;index_right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
<span class="n">rail_not_present</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="let-s-clean-things-up-a-little-and-create-the-final-geodataframe-we-want-to-work-with">
<h2>Let’s clean things up a little and create the final geodataframe we want to work with<a class="headerlink" href="#let-s-clean-things-up-a-little-and-create-the-final-geodataframe-we-want-to-work-with" title="Link to this heading">#</a></h2>
<p>We can clean things up and then create a map and a descriptive statistics plot to show our findings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#create list of columns relevant to our analysis</span>
<span class="n">columns_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name_x&quot;</span><span class="p">,</span><span class="s2">&quot;Neighbid&quot;</span><span class="p">,</span><span class="s2">&quot;name_y&quot;</span><span class="p">,</span><span class="s2">&quot;asthma_pct&quot;</span><span class="p">,</span><span class="s2">&quot;index_right&quot;</span><span class="p">,</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>

<span class="c1">#create our final analysis geodataframe and create a column &#39;rail_present&#39; that is true </span>
<span class="c1">#if railways are in the neighbourhood and false if not:</span>
<span class="n">final_toronto_analysis</span> <span class="o">=</span> <span class="n">no_duplicates_gdf</span><span class="p">[</span><span class="n">columns_to_keep</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rail_present</span><span class="p">,</span> <span class="s1">&#39;rail_present&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rail_not_present</span><span class="p">,</span> <span class="s1">&#39;rail_present&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;asthma_pct&quot;</span><span class="p">,</span> 
                               <span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;rail_present&quot;</span><span class="p">,</span> 
                               <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> 
                  <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">})</span>
<span class="n">railways</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Asthma Percent&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Rail Present?&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Percent of Population with Asthma for Neighbourhoods with Railways&quot;</span><span class="p">,</span> 
             <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It seems that the presence of railway in neighborhood is related to higher asthma rate!</p>
<p>But is it a <strong>significant</strong> relationship?</p>
<p>Remember the comparison between two groups before!</p>
<p>Let’s do a hypothesis testing using shuffling method.</p>
<ul class="simple">
<li><p>Null hypothesis: There is no differences of asthma rates between neighborhoods with railways and without railways.</p></li>
<li><p>Alternative hypothesis: Neighborhoods with railways have higher asthma rates than the neighborhoods without railways.</p></li>
</ul>
<p>Let’s do a exercise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulation</span>
<span class="n">simulated_diffs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
    <span class="n">simulated</span> <span class="o">=</span> <span class="n">final_toronto_analysis</span><span class="p">[</span><span class="s1">&#39;rail_present&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">mean_railway</span> <span class="o">=</span> <span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">simulated</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">mean_norailway</span> <span class="o">=</span> <span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">simulated</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">sim_diff</span> <span class="o">=</span> <span class="n">mean_railway</span> <span class="o">-</span> <span class="n">mean_norailway</span>
    <span class="n">simulated_diffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim_diff</span><span class="p">)</span>

<span class="c1"># Calculate observed difference</span>
<span class="n">obs_mean_railway</span> <span class="o">=</span> <span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_toronto_analysis</span><span class="p">[</span><span class="s1">&#39;rail_present&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">obs_mean_norailway</span> <span class="o">=</span> <span class="n">final_toronto_analysis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_toronto_analysis</span><span class="p">[</span><span class="s1">&#39;rail_present&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">obs_diff</span> <span class="o">=</span> <span class="n">obs_mean_railway</span> <span class="o">-</span> <span class="n">obs_mean_norailway</span>

<span class="c1"># Calculate p-value</span>
<span class="n">simulated_diffs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;sim_diffs&#39;</span> <span class="p">:</span> <span class="n">simulated_diffs</span><span class="p">})</span>

<span class="n">numgreater</span> <span class="o">=</span> <span class="p">(</span><span class="n">simulated_diffs_df</span><span class="p">[</span><span class="s1">&#39;sim_diffs&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">obs_diff</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The number of simulated differences greater than the observed difference is:&#39;</span><span class="p">,</span> <span class="n">numgreater</span><span class="p">)</span>

<span class="n">numsmaller</span> <span class="o">=</span> <span class="p">(</span><span class="n">simulated_diffs_df</span><span class="p">[</span><span class="s1">&#39;sim_diffs&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">obs_diff</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The number of simulated differences smaller than the observed difference is:&#39;</span><span class="p">,</span> <span class="n">numsmaller</span><span class="p">)</span>

<span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">numgreater</span> <span class="o">+</span> <span class="n">numsmaller</span><span class="p">)</span><span class="o">/</span> <span class="mi">5000</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The p-value is:&#39;</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Great! We can say the asthma rates in neighborhoods with railways are significantly higher than the rates in neighborhoods without railways.</p>
<p>But is this a causal relationship?</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./weekly-materials/week10/lecture"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../../week09/homework/Homework_9.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">GG274 Homework 9: Bootstrap Confidence Intervals</p>
      </div>
    </a>
    <a class="right-next"
       href="../lab/Lab_10.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">GGR274 Lab 10: Project data description and analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Class 10</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mar-19-2024">Mar. 19, 2024</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#review-of-linear-regression">Review of linear regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-effect-of-recent-immigration-on-asthma-rates-in-toronto-neighbourhoods">What is the effect of recent immigration on asthma rates in Toronto neighbourhoods?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sociodemographic-data">Sociodemographic data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#asthma-data">Asthma data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-sociodemographic-and-asthma-data">Merge Sociodemographic and asthma data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-regression-model-of-asthma-on-immigration">A regression model of asthma on immigration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-data">Plot the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-the-regression-model">Fit the regression model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-summary-of-the-regression-model">Statistical summary of the regression model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-regression-model-is-the-equation">The regression model is the equation:</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy-of-the-regression-model">Accuracy of the regression model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-and-testing-a-model">Training and testing a model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#splitting-a-pandas-dataframe-by-index">Splitting a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> by <code class="docutils literal notranslate"><span class="pre">index</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-training-and-test-data-sets-from-a-single-dataset">Creating training and test data sets from a single dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1">Step 1:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-fit-the-regression-model-on-the-training-data">Step 2: Fit the regression model on the training data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-compute-fitted-values-using-training-data">Step 3: Compute fitted values using training data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-evaluate-accuracy-using-root-mean-squared-error-on-training-data">Step 4: Evaluate accuracy using root mean-squared error on training data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-evaluate-the-accuracy-of-regression-model-on-the-test-data-using-root-mean-squared-error">Step 5: Evaluate the accuracy of regression model on the test data using root mean-squared error</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-of-data-analysis-using-linear-regression-model">Conclusion of data analysis using linear regression model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#are-there-other-sociodemographic-factors-in-our-data-that-might-effect-asthma-rates">Are there other sociodemographic  factors in our data that might effect asthma rates?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-review-of-linear-regression">A quick review of linear regression</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-spatial-data">Introduction to spatial data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-spatial-data-matters">Why Spatial Data Matters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-spatial-data">What are spatial data?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-want-spatial-data">Why do we want spatial data?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-spatial-data">Types of Spatial Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#raster-data-vector-data">raster data &amp; vector data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#raster-data">Raster data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#vector-data">Vector data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-are-these-data-stored-in-a-computer">How are these data stored in a computer?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generally-raster-data-are-stored-as-a-matrix">Generally raster data are stored as a matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#vector-data-is-stored-in-many-different-ways">Vector data is stored in many different ways…</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introducing-geopandas">Introducing GeoPandas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-work-with-spatial-data-in-python">How do we work with spatial data in python?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-we-want-to-import-a-spatial-data-file">Now we want to import a spatial data file.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#to-load-the-spatial-data-we-need-to-create-something-known-as-a-geodataframe">To load the spatial data we need to create something known as a geodataframe:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-if-we-want-to-make-a-map-what-do-we-do">Now if we want to make a map, what do we do?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#that-s-nice">That’s nice…</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-with-a-column-that-contains-a-number-what-happens-there">Let’s try with a column that contains a number… what happens there?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-again-with-neighbourhoods">let’s try again with neighbourhoods:</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#we-want-to-know-what-is-happening-inside-of-them">We want to know what is happening inside of them!</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-we-bring-data-from-a-table-into-a-geodataframe">How do we bring data from a table into a geodataframe?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-that-the-nbrhd-spat-id-in-neighborhood-geodataframe-is-string">Note that the <code class="docutils literal notranslate"><span class="pre">nbrhd_spat_id</span></code> in Neighborhood GeoDataFrame is string</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#now-let-s-do-the-join">Now let’s do the join!</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#now-that-we-have-merged-our-spatial-data-with-our-attribute-data">Now that we have merged our spatial data with our attribute data…</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#we-can-plot-the-values-using-the-geodataframe-maps-plotting-capability">we can plot the values using the geodataframe maps plotting capability</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hmm-looks-like-there-are-some-spatial-patterns">Hmm - Looks like there are some spatial patterns!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interesting">Interesting!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-dig-into-this-more-let-s-classify-the-data-using-quartiles">To dig into this more, let’s classify the data using quartiles…</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#first-steps-into-spatial-analysis">First steps into “spatial analysis”…</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-might-be-related-to-these-areas-with-higher-asthma">What might be related to these areas with higher asthma?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coordinate-systems-and-projections">Coordinate systems and projections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-that-our-two-geodataframe-spatial-layers-are-in-the-same-projection-we-can-plot-them-together">Now that our two geodataframe spatial layers are in the same projection, we can plot them together</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hmm-could-there-be-something-there">Hmm - could there be something there?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-do-a-spatial-join">Let’s do a “spatial join”</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#woah">Woah!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-check-this-new-no-duplicate-geodataframe-to-see-if-looks-right">Let’s check this new, no duplicate geodataframe to see if looks right.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#this-looks-good-based-on-visual-inspection">This looks good, based on visual inspection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-clean-things-up-a-little-and-create-the-final-geodataframe-we-want-to-work-with">Let’s clean things up a little and create the final geodataframe we want to work with</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By GGR274 Instructors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>