
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Class 11 &#8212; Computation and Data Science for Social Sciences</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'weekly-materials/week11/lecture/Class11_GGR274_CL';</script>
    <link rel="icon" href="../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="GGR274 Lab 11: Data analysis and result presentation" href="../lab/Lab_11.html" />
    <link rel="prev" title="Homework 10 : Linear Regression" href="../../week10/homework/Homework_10.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../jupyter-book/index.html">
  
  
  
  
  
  
    <p class="title logo__title">Computation and Data Science for Social Sciences</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../jupyter-book/index.html">
                    👋 Course Website for GGR274H1-S Winter 2024
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Quick Links</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../syllabus/ggr274_syllabus.html">Course Syllabus</a></li>
<li class="toctree-l1"><a class="reference external" href="https://q.utoronto.ca/courses/338580/announcements">Announcements</a></li>
<li class="toctree-l1"><a class="reference external" href="https://piazza.com/utoronto.ca/winter2024/ggr274h1">Piazza</a></li>
<li class="toctree-l1"><a class="reference external" href="https://forms.office.com/Pages/ResponsePage.aspx?id=JsKqeAMvTUuQN7RtVsVSEF-wqptfr85NieT8UyliaxxUOUtMSVFUQkFTNVdRTlVJNkZFQU84NldYUi4u">Course Feedback Form</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../guides/jupyterhub_guide.html">JupyterHub Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/markus_guide.html">MarkUs Guide</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://q.utoronto.ca/courses/338580/files?preview=29750629">Prof. Li's Slides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/lecture/Class1_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/lecture/Class1_GGR274_IM.html">Prof. Musabirov's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/lab/Lab_1.html">Lab 01 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/lab/Lab_1_solutions.html">Lab 01 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/homework/Homework_1.html">Homework 01 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/homework/Homework_1_solution.html">Homework 01 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week02/lecture/Class2_GGR274_DL_IM.html">Prof. Musabirov's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/lab/Lab_2.html">Lab 02 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/lab/Lab_2_solutions.html">Lab 02 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/homework/Homework_2.html">Homework 02 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/homework/Homework_2_solution.html">Homework 02 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week03/lecture/Class3_GGR274_DL_IM.html">Prof. Musabirov's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/lab/Lab_3.html">Lab 03 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/lab/Lab_3_solutions.html">Lab 03 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/homework/Homework_3.html">Homework 03 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/homework/Homework_3_solution.html">Homework 03 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://q.utoronto.ca/courses/338580/files?preview=30071956">Prof. Li's Slides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/lecture/Class4_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/lab/Lab_4.html">Lab 04 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/lab/Lab_4_solutions.html">Lab 04 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/homework/Homework_4.html">Homework 04 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/homework/marking/Homework_4_solution.html">Homework 04 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week05/lecture/Class5_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/lab/Lab_5.html">Lab 05 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/lab/Lab_5_solutions.html">Lab 05 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/homework/Homework_5.html">Homework 05 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week05/homework/marking/Homework_5_solution.html">Homework 05 Solutions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Practice Midterm</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../practice/sample_midterm/GGR274_Midterm.html">2022 Midterm Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../practice/review_w1-3.html">Review of frequent errors and extra examples for weeks 1-3</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Midterm</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../tests/midterm/Midterm.html">Midterm Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tests/midterm-makeup/Midterm_makeup.html">Midterm (makeup) Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Project</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../project/proposal/GGR274_Project_Proposal.html">Project Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project/presentation/GGR274_Final_Project_Instruction.html">Final Project Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project/presentation/extras/GGR274DSconfslides.html">Final Project Presentation Slides Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project/presentation/extras/Tipsandtricksforslides.html">Additional Tips and Tricks for Creating Slides in a Jupyter Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 7</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://q.utoronto.ca/courses/338580/files?preview=30627394">Prof. Li's Slides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week07/lecture/Class7_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week07/lab/Lab_7.html">Lab 07 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week07/lab/Lab_7_solutions.html">Lab 07 Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week07/homework/Homework_7.html">Homework 07 Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 8</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week08/lecture/Class8_GGR274_MM.html">Prof. Moon's Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/lab/Lab_8.html">Lab 08 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/homework/Homework_8.html">Homework 08 Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 9</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week09/lecture/Class9_GGR274_CL.html">Class 9</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../week09/lab/Lab_9.html">Lab 09 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week09/homework/Homework_9.html">Homework 09 Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 10</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../week10/lecture/Class10_GGR274_CL.html">Class 10</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../week10/lab/Lab_10.html">Lab 10 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week10/homework/Homework_10.html">Homework 10 Notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 11</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Class 11</a></li>



<li class="toctree-l1"><a class="reference internal" href="../lab/Lab_11.html">Lab 11 Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../homework/Homework_11.html">Homework 11 Notebook</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://jupyter.utoronto.ca/hub/user-redirect/git-pull?repo=https%3A//github.com/UofTCompDSci/ggr274-20241&urlpath=tree/ggr274-20241/weekly-materials/week11/lecture/Class11_GGR274_CL.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/weekly-materials/week11/lecture/Class11_GGR274_CL.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Class 11</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Class 11</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mar-26-2024">Mar. 26, 2024</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#a-review-of-spatial-data-and-mapping">A review of spatial data and mapping</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-bring-in-the-same-files-we-worked-with-last-week">Let’s bring in the same files we worked with last week</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-geopandas-to-load-in-spatial-data">1. Using GeoPandas to load in spatial data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simplify-the-geodataframe">2. Simplify the geodataframe</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-health-information-and-simplify-it">3. Import health information and simplify it</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#join-our-neighbourhood-gdf-with-our-asthma-rate-df">4. Join our neighbourhood gdf with our asthma rate df:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-the-attribute-data-asthma">5. Map the attribute data (asthma)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pop-quiz">POP QUIZ!!</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#more-on-cartography">More on Cartography</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-this-point-we-have-used-quantiles-to-classify-values-in-maps">To this point we have used quantiles to classify values in maps.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-other-common-options-do-we-have-see-the-document-of-geodataframe-plot-and-mapclassify">What other common options do we have?  See the document of GeoDataFrame.plot and mapclassify</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-background">Adding a background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-reproject-the-map-into-web-mercator-and-compare-to-the-original-projection">Let’s reproject the map into Web Mercator and compare to the original projection:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-add-the-web-basemap-we-can-do-the-following">To add the web basemap, we can do the following</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-else-we-can-visualize-the-data-analysis-results-together">What else? We can visualize the data analysis results together!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-in-the-immigration-data">1. load in the immigration data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-dataset">2. Merge dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conduct-linear-regression">3. conduct linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-results">4. Visualize the results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-clustering">Introduction to clustering</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-clustering">What is clustering?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-want-to-identify-clusters">Why do we want to identify clusters?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-clustering-at-a-high-level-is-doing-the-same-thing-but-one-attribute-to-consider-is-geography">Spatial clustering, at a high level, is doing the same thing but one attribute to consider is geography.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#if-we-want-to-do-spatial-clustering-of-a-variable-what-two-pieces-of-information-do-we-need-don-t-over-think">If we want to do ‘spatial clustering’ of a variable what two pieces of information do we need? (don’t over think!!!)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelation">Autocorrelation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-autocorrelation">Spatial Autocorrelation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#so-again-information-do-we-need-to-do-answer-this-question">So again, information do we need to do answer this question?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-each-observation-in-this-case-neighborhood-we-need-to-know-their-neighbours">1) For each observation (in this case, neighborhood) we need to know their neighbours!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#next-we-need-to-describe-the-value-of-our-attribute-of-interest-in-neighbours">2) Next we need to describe the value of our attribute of interest in neighbours</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finally-now-we-can-see-how-a-neighbourhood-s-attribute-compares-to-its-neighbours">3) Finally, now we can see how a neighbourhood’s attribute compares to its neighbours.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-talk-about-the-code-to-show-how-this-works-next-week">We will talk about the code to show how this works next week.</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>Before the class…</p>
<p>Some information about the final exam.</p>
<ul class="simple">
<li><p>In-person exam</p></li>
<li><p>Computer-based exam</p></li>
<li><p>Open-book (access to all course materials in your JupyterHub), but no Internet</p></li>
<li><p>Students be divided into three rooms, which will be announced in the Quercus.</p></li>
</ul>
<section class="tex2jax_ignore mathjax_ignore" id="class-11">
<h1>Class 11<a class="headerlink" href="#class-11" title="Link to this heading">#</a></h1>
<section id="mar-26-2024">
<h2>Mar. 26, 2024<a class="headerlink" href="#mar-26-2024" title="Link to this heading">#</a></h2>
<p>By the end of this class, you’ll be able to:</p>
<ul class="simple">
<li><p>Load in spatial data</p></li>
<li><p>Join geodataframes with attribute tables</p></li>
<li><p>Plot maps in multiple ways</p></li>
<li><p>Get some knowledge about clustering (will talk about it next week!)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## Let&#39;s install and then load libraries</span>
<span class="c1"># %pip install geopandas</span>
<span class="c1"># %pip install mapclassify</span>
<span class="c1"># %pip install contextily</span>
<span class="c1"># %pip install libpysal</span>
<span class="c1"># %pip install esda</span>
<span class="c1"># %pip install splot</span>
<span class="c1"># %pip install xlrd</span>
<span class="c1"># %pip install numba==0.53</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s start with importing the packages</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mapclassify</span>
<span class="kn">import</span> <span class="nn">esda</span>
<span class="kn">import</span> <span class="nn">splot</span>
<span class="kn">import</span> <span class="nn">libpysal</span> <span class="k">as</span> <span class="nn">lps</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">xlrd</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="a-review-of-spatial-data-and-mapping">
<h1>A review of spatial data and mapping<a class="headerlink" href="#a-review-of-spatial-data-and-mapping" title="Link to this heading">#</a></h1>
<section id="let-s-bring-in-the-same-files-we-worked-with-last-week">
<h2>Let’s bring in the same files we worked with last week<a class="headerlink" href="#let-s-bring-in-the-same-files-we-worked-with-last-week" title="Link to this heading">#</a></h2>
<p>We’ll be working with the Toronto Neighbourhoods spatial data and the health data today:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Toronto_Neighbourhoods.geojson</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1_ahd_neighb_db_ast_hbp_mhv_copd_2007.xls</span></code></p></li>
</ul>
</section>
<section id="using-geopandas-to-load-in-spatial-data">
<h2>1. Using GeoPandas to load in spatial data<a class="headerlink" href="#using-geopandas-to-load-in-spatial-data" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;Toronto_Neighbourhoods.geojson&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The content of the spatial data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>What is geometry?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">first_neighbor</span> <span class="o">=</span> <span class="n">nbrhd</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_neighbor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">first_neighbor</span>
</pre></div>
</div>
</div>
</div>
<p>Another example of geometry</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rails</span> <span class="o">=</span>  <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;toronto_rails.geojson&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rails</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">first_rail_points</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">79.5125670999999</span><span class="p">,</span><span class="mf">43.814361500000075</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51253669999994</span><span class="p">,</span> <span class="mf">43.81447250000008</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.512524</span><span class="p">,</span> <span class="mf">43.81452850000005</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51251939999992</span><span class="p">,</span><span class="mf">43.814607</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51251739999992</span><span class="p">,</span><span class="mf">43.814716900000064</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51252729999993</span><span class="p">,</span><span class="mf">43.814817</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51254659999995</span><span class="p">,</span><span class="mf">43.81492840000004</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51261019999993</span><span class="p">,</span><span class="mf">43.815184800000054</span><span class="p">),</span>
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51270719999991</span><span class="p">,</span><span class="mf">43.815575100000046</span><span class="p">),</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51291559999993</span><span class="p">,</span><span class="mf">43.816454400000055</span><span class="p">),</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51339439999992</span><span class="p">,</span><span class="mf">43.81834120000008</span><span class="p">),</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51371579999994</span><span class="p">,</span><span class="mf">43.819633</span><span class="p">),</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.513803</span><span class="p">,</span><span class="mf">43.820002</span><span class="p">),</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51385459999995</span><span class="p">,</span> <span class="mf">43.82019790000004</span><span class="p">),</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51389059999991</span><span class="p">,</span> <span class="mf">43.820318</span><span class="p">),</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mf">79.51392659999993</span><span class="p">,</span> <span class="mf">43.82045130000006</span><span class="p">),]</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span> <span class="n">first_rail_points</span><span class="p">)</span>
<span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rails</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Note: the difference between plotting on Cartesian coordinate system and plotting as a geo-object comes from the different coordination system used by the GeoDataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rails</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
</div>
<p>Therefore, a <code class="docutils literal notranslate"><span class="pre">GeoDataframe</span></code> can be understood as a <code class="docutils literal notranslate"><span class="pre">GeoSeries</span></code> with several <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<p><img alt="figure" src="../../../_images/dataframe.svg" /></p>
</section>
<section id="simplify-the-geodataframe">
<h2>2. Simplify the geodataframe<a class="headerlink" href="#simplify-the-geodataframe" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># important columns</span>
<span class="n">important_spat_cols</span> <span class="o">=</span> <span class="n">nbrhd</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">17</span><span class="p">]]</span>
<span class="n">important_spat_cols</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rename dictionary</span>
<span class="n">colnames_spat</span> <span class="o">=</span> <span class="p">{</span><span class="n">important_spat_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
           <span class="n">important_spat_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;nbrhd_spat_id&#39;</span><span class="p">,</span>
           <span class="n">important_spat_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;geometry&#39;</span><span class="p">}</span>
<span class="n">colnames_spat</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Selec the important columns</span>
<span class="n">nbrhd_simple</span> <span class="o">=</span> <span class="n">nbrhd</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">nbrhd_simple</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="p">[</span><span class="n">important_spat_cols</span><span class="p">]</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames_spat</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Convert our spatial ID from a string to a number:</p>
<ul class="simple">
<li><p>rembmer the type of spatial ID in the health dataset is <code class="docutils literal notranslate"><span class="pre">int</span></code> but here in spatial dataset it is <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#create a new variable in the nbrhd_simple geodataframe and store the new number</span>
<span class="c1">#version of the neighbourhood id here</span>
<span class="n">nbrhd_simple</span><span class="p">[</span><span class="s2">&quot;Neighbid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="p">[</span><span class="s2">&quot;nbrhd_spat_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;nbrhd_spat_id&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Neighbid&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-health-information-and-simplify-it">
<h2>3. Import health information and simplify it<a class="headerlink" href="#import-health-information-and-simplify-it" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;1_ahd_neighb_db_ast_hbp_mhv_copd_2007.xls&#39;</span> <span class="c1">#file name</span>
<span class="n">sname</span> <span class="o">=</span> <span class="s1">&#39;1_ahd_neighb_asthma_2007&#39;</span> <span class="c1">#sheet name in excel file</span>

<span class="c1">#store excel sheet with asthma data in a dataframe variable</span>
<span class="n">asthma_neighb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sname</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asthma_neighb</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asthma_neighb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># important columns</span>
<span class="c1">## Note: Instead of copying the column names, we can use the number to avoid any miscopies.</span>
<span class="n">important_cols</span> <span class="o">=</span> <span class="n">asthma_neighb</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]]</span> 

<span class="c1"># rename dictionary</span>
<span class="n">colnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">important_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;Neighbid&#39;</span><span class="p">,</span> 
            <span class="n">important_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> 
            <span class="n">important_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;adult_pop&#39;</span><span class="p">,</span>
            <span class="n">important_cols</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">:</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select important columns</span>
<span class="n">asthma_rates</span> <span class="o">=</span> <span class="n">asthma_neighb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">asthma_rates</span> <span class="o">=</span> <span class="n">asthma_rates</span><span class="p">[</span><span class="n">important_cols</span><span class="p">]</span>

<span class="n">asthma_rates</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">asthma_rates</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="join-our-neighbourhood-gdf-with-our-asthma-rate-df">
<h2>4. Join our neighbourhood gdf with our asthma rate df:<a class="headerlink" href="#join-our-neighbourhood-gdf-with-our-asthma-rate-df" title="Link to this heading">#</a></h2>
<p>Take a look at both data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asthma_rates</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>For the spatial data, we sort it by neighborhood id to check the consistency</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Neighbid&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd_simple</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">asthma_rates</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Neighbid&quot;</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="map-the-attribute-data-asthma">
<h2>5. Map the attribute data (asthma)<a class="headerlink" href="#map-the-attribute-data-asthma" title="Link to this heading">#</a></h2>
<p>We need to first set the “stage” of the figure.</p>
<p>Then we plot:</p>
<ul class="simple">
<li><p>the asthma rate (<code class="docutils literal notranslate"><span class="pre">column</span></code> = “asthma_pct”),</p></li>
<li><p>in 5 quantiles (<code class="docutils literal notranslate"><span class="pre">scheme</span></code> = “quantiles”, <code class="docutils literal notranslate"><span class="pre">k</span></code>=5),</p></li>
<li><p>in the stage (<code class="docutils literal notranslate"><span class="pre">ax</span></code> = axes),</p></li>
<li><p>with legend (<code class="docutils literal notranslate"><span class="pre">legend</span></code> = True).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, let&#39;s create a figure variable &quot;fig&quot; and an axes variables called &quot;ax&quot;.</span>
<span class="c1"># This code sets the stage - it says how many images - by rows/columns</span>
<span class="c1"># We can also set other figure attributes in here, like figure size using figsize</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="c1"># Then plot the data with certain arguements:</span>
<span class="c1"># These two codes need to write in the same code, i.e., run simultaneously</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGn&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> 
                  <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                  <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Make a figure with two maps side by side…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="c1"># pick the first cell in the figure</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;name_x&quot;</span><span class="p">,</span>
           <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;tab20&quot;</span><span class="p">)</span>

<span class="c1"># pick the second cell in the figure</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;asthma_pct&quot;</span><span class="p">,</span>
           <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;YlGn&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pop-quiz">
<h2>POP QUIZ!!<a class="headerlink" href="#pop-quiz" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>How would we make a figure with 3 maps in 1 row?</p></li>
<li><p>How would we make a figure with 3 maps in 1 <strong>column</strong>?</p></li>
<li><p>How would we make a figure with 6 maps in 3 rows and 2 columns?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3 maps in 1 row</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(,</span> <span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3 maps in 1 column</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(,</span> <span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 6 maps in 3 rows and 2 columns</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(,</span> <span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="more-on-cartography">
<h1>More on Cartography<a class="headerlink" href="#more-on-cartography" title="Link to this heading">#</a></h1>
<section id="to-this-point-we-have-used-quantiles-to-classify-values-in-maps">
<h2>To this point we have used quantiles to classify values in maps.<a class="headerlink" href="#to-this-point-we-have-used-quantiles-to-classify-values-in-maps" title="Link to this heading">#</a></h2>
<section id="what-other-common-options-do-we-have-see-the-document-of-geodataframe-plot-and-mapclassify">
<h3>What other common options do we have?  See the document of <a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html">GeoDataFrame.plot</a> and <a class="reference external" href="https://github.com/pysal/mapclassify/tree/main">mapclassify</a><a class="headerlink" href="#what-other-common-options-do-we-have-see-the-document-of-geodataframe-plot-and-mapclassify" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Equal Intervals</p></li>
</ol>
<ul class="simple">
<li><p>This classification method “divides the data into equal size classes (e.g., 0-10, 10-20, 20-30, etc.) and works best on data that is generally spread across the entire range. <strong>CAUTION</strong>: Avoid equal interval if your data are skewed to one end or if you have one or two really large outlier values.”</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Natural Breaks</p></li>
</ol>
<ul class="simple">
<li><p>This classification method “is a kind of “optimal” classification scheme that finds class breaks that will minimize within-class variance and maximize between-class differences.” <strong>However</strong>, these breaks will be unique to each dataset and makes it difficult to compare across different maps.</p></li>
</ul>
<p>Before plot the variable, we usually want to see its distribution to see if certain classification can fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">asthma_pct</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Close to normal distribution, which means that the equal intervals should be fine.</p>
<p>Let’s use the <code class="docutils literal notranslate"><span class="pre">scheme</span></code> parameter to the plot our asthma percentages using quartiles, equal intervals, and natural breaks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;Quantiles&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                  <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                  
                  <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;EqualInterval&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                  <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                  
                  <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>

<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;NaturalBreaks&#39;</span><span class="p">,</span> 
                  <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
                  <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                  
                  <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Quartiles&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Equal Intervals&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Natural Breaks&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># current_fig = plt.gcf() #get current figure aka gcf</span>
<span class="c1"># current_fig.savefig(&#39;asthma_three_class.png&#39;,dpi=100) #export maps as an image file!</span>
</pre></div>
</div>
</div>
</div>
<p>Another way to show the figure: save it and import it to show in the presentation!
<img alt="figure" src="../../../_images/asthma_three_class.png" /></p>
</section>
</section>
<section id="adding-a-background">
<h2>Adding a background<a class="headerlink" href="#adding-a-background" title="Link to this heading">#</a></h2>
<p>What if we want to add a background to our maps? It’s pretty easy!</p>
<p>We will use the <a class="reference external" href="https://contextily.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">contextily</span></code> library</a> to do this.</p>
<p>But first we need to double check that our coordinate reference system is properly set. To layer our maps on top of a web background map, we need to make sure the projection is set to something known as “Web Mercator”: <a class="reference external" href="https://epsg.io/3857">https://epsg.io/3857</a></p>
<p>That is, make our spatial data have the <em>same</em> coordinate reference system as the web map.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#check current crs: WGS 84 (EPSG:4326)</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
</div>
<section id="let-s-reproject-the-map-into-web-mercator-and-compare-to-the-original-projection">
<h3>Let’s reproject the map into Web Mercator and compare to the original projection:<a class="headerlink" href="#let-s-reproject-the-map-into-web-mercator-and-compare-to-the-original-projection" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd_webmap</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:3857&quot;</span><span class="p">)</span>

<span class="c1">#let&#39;s throw in a polar projection just for fun! </span>
<span class="c1">## https://www.esri.com/arcgis-blog/products/imagery/imagery/two-views-from-the-top-of-the-world/</span>
<span class="n">nbrhd_polar</span> <span class="o">=</span> <span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:3995&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1">#original</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1">#web mercator</span>
<span class="n">nbrhd_webmap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#polar projection</span>
<span class="n">nbrhd_polar</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;WGS 84&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Web Mercator&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Polar&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note: The coordinate reference system will change how the geometry is plotted in a 2D map.</p>
</section>
<section id="to-add-the-web-basemap-we-can-do-the-following">
<h3>To add the web basemap, we can do the following<a class="headerlink" href="#to-add-the-web-basemap-we-can-do-the-following" title="Link to this heading">#</a></h3>
<p>Remember we have import the <code class="docutils literal notranslate"><span class="pre">contextily</span></code> package as <code class="docutils literal notranslate"><span class="pre">cx</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1">#alpha parameter makes the map transparent</span>
<span class="n">nbrhd_webmap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;asthma_pct&quot;</span><span class="p">,</span> <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;quantiles&quot;</span><span class="p">,</span>
                  <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span>
                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">contextily</span></code> pacakage also provides different map source.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Under</span> <span class="n">the</span> <span class="n">provider</span> <span class="n">of</span> <span class="n">CartoDB</span><span class="p">:</span>
<span class="o">-</span> <span class="n">Positron</span>
<span class="o">-</span> <span class="n">PositronNoLabels</span> 
<span class="o">-</span> <span class="n">PositronOnlyLabels</span> 
<span class="o">-</span> <span class="n">DarkMatter</span> 
<span class="o">-</span> <span class="n">DarkMatterNoLabels</span> 
<span class="o">-</span> <span class="n">DarkMatterOnlyLabels</span> 
<span class="o">-</span> <span class="n">Voyager</span> 
<span class="o">-</span> <span class="n">VoyagerNoLabels</span>
<span class="o">-</span> <span class="n">VoyagerOnlyLabels</span>
<span class="o">-</span> <span class="n">VoyagerLabelsUnder</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1">#alpha parameter makes the map transparent</span>
<span class="n">nbrhd_webmap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;asthma_pct&quot;</span><span class="p">,</span> <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;quantiles&quot;</span><span class="p">,</span>
                  <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">,</span>
                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span>
              <span class="n">source</span><span class="o">=</span><span class="n">cx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Voyager</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="what-else-we-can-visualize-the-data-analysis-results-together">
<h2>What else? We can visualize the data analysis results together!<a class="headerlink" href="#what-else-we-can-visualize-the-data-analysis-results-together" title="Link to this heading">#</a></h2>
<p>Recall we’ve conducted a linear regression on the correlation between asthma and immigration.</p>
<p>We can plot the data description, spatial distribution, and linear regression togehter.</p>
<section id="load-in-the-immigration-data">
<h3>1. load in the immigration data<a class="headerlink" href="#load-in-the-immigration-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;1_socdem_neighb_2006-2.xls&#39;</span>
<span class="n">sname</span> <span class="o">=</span> <span class="s1">&#39;socdem_2006&#39;</span>
<span class="n">socdem_neighb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sname</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">socdem_neighb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">socdem_neighb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Important columns</span>
<span class="n">important_cols</span> <span class="o">=</span> <span class="n">socdem_neighb</span><span class="o">.</span><span class="n">columns</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">21</span><span class="p">]]</span>

<span class="n">rename_dic</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">important_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s1">&#39;Neighbid&#39;</span><span class="p">,</span>
    <span class="n">important_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="n">important_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;median_income&#39;</span><span class="p">,</span>
    <span class="n">important_cols</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s1">&#39;immigration5&#39;</span>
<span class="p">}</span>
<span class="n">rename_dic</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select important columns</span>
<span class="n">socdem_neighb</span> <span class="o">=</span> <span class="n">socdem_neighb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">socdem_neighb</span> <span class="o">=</span> <span class="n">socdem_neighb</span><span class="p">[</span><span class="n">important_cols</span><span class="p">]</span>
<span class="n">socdem_neighb</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">rename_dic</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">socdem_neighb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="merge-dataset">
<h3>2. Merge dataset<a class="headerlink" href="#merge-dataset" title="Link to this heading">#</a></h3>
<p>Merge <code class="docutils literal notranslate"><span class="pre">socdem_neighb</span></code> to <code class="docutils literal notranslate"><span class="pre">nbrhd_webmap</span></code>, because we want to map it on a basemap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nbrhd_webmap</span> <span class="o">=</span> <span class="n">nbrhd_webmap</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">socdem_neighb</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Neighbid&#39;</span><span class="p">)</span>

<span class="n">nbrhd_webmap</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="conduct-linear-regression">
<h3>3. conduct linear regression<a class="headerlink" href="#conduct-linear-regression" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
<span class="n">reg_asthmaimm</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s1">&#39;asthma_pct ~ immigration5&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nbrhd_webmap</span><span class="p">)</span> <span class="c1"># setup the model</span>
<span class="n">reg_asthmaimm_fit</span> <span class="o">=</span> <span class="n">reg_asthmaimm</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">reg_asthmaimm_sum</span> <span class="o">=</span> <span class="n">reg_asthmaimm_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="n">reg_asthmaimm_sum</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-the-results">
<h3>4. Visualize the results<a class="headerlink" href="#visualize-the-results" title="Link to this heading">#</a></h3>
<p>The regression analysis shows a significant coefficient of immigration percent, indicating a significant linear relationship.</p>
<p>Therefore, we can visualize these two variables as a scatter plot and regressed line.</p>
<p>What else do we want?</p>
<ul class="simple">
<li><p>data description of the dependent variable</p></li>
<li><p>map both variables</p></li>
</ul>
<p>Then we can plot the four figures in a (2,2) manner.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="c1"># Description of the dependent variable</span>
<span class="n">nbrhd_simple</span><span class="o">.</span><span class="n">asthma_pct</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Regression</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;asthma_pct&#39;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;immigration5&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nbrhd_webmap</span><span class="p">,</span> <span class="n">ci</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>


<span class="c1"># Map of the dependent variable</span>
<span class="n">nbrhd_webmap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;asthma_pct&quot;</span><span class="p">,</span> <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;quantiles&quot;</span><span class="p">,</span>
                  <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Percent Asthmatic&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Map of the independent variable</span>
<span class="n">nbrhd_webmap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;immigration5&quot;</span><span class="p">,</span> <span class="n">scheme</span> <span class="o">=</span> <span class="s2">&quot;quantiles&quot;</span><span class="p">,</span>
                  <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Immigration rate&#39;</span><span class="p">,</span> 
                               <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Make some adjustment</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Historgram of asthma percentage&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s1">&#39;Asthma percentage %&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s1">&#39;Proportion %&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Regression of asthma percentage on immigration rate&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s1">&#39;Immigration rate recent 5 years %&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s1">&#39;Asthma percentage %&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Asthma percentage in Toronto&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Immigration rate recent 5 years in Toronto&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>


<span class="n">current_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span> 
<span class="n">current_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;results.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> <span class="c1">#export maps as an image file!</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="results" src="../../../_images/results.png" /></p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-to-clustering">
<h1>Introduction to clustering<a class="headerlink" href="#introduction-to-clustering" title="Link to this heading">#</a></h1>
<section id="what-is-clustering">
<h2>What is clustering?<a class="headerlink" href="#what-is-clustering" title="Link to this heading">#</a></h2>
<p>Clustering, generally, is the act of grouping similar things with eachother.</p>
<p>We can do this with non-spatial data as well as spatial data.</p>
<p>One common clustering method is k-means, which we won’t cover in this class, but if you’re interested, there’s a nice tutorial on the method here:</p>
<p><a class="reference external" href="https://towardsdatascience.com/machine-learning-algorithms-part-9-k-means-example-in-python-f2ad05ed5203">https://towardsdatascience.com/machine-learning-algorithms-part-9-k-means-example-in-python-f2ad05ed5203</a></p>
</section>
<section id="why-do-we-want-to-identify-clusters">
<h2>Why do we want to identify clusters?<a class="headerlink" href="#why-do-we-want-to-identify-clusters" title="Link to this heading">#</a></h2>
<p>Because clusters identify groups of data with similar attribute values, we can use it to begin to understand what <strong>drives</strong> the grouping.</p>
<p>For example, we may have data on individuals’ income outcomes and education levels (e.g., total number of years in schools, colleges, and universities).</p>
<p>If we perform a cluster analysis, we can identify discrete groups which may be easier to work with when we want to do further analysis.</p>
<p>These groups may be something like:</p>
<ul class="simple">
<li><p>cluster 1: high income, more education</p></li>
<li><p>cluster 2: high income, less education</p></li>
<li><p>cluster 3: low income, less education</p></li>
<li><p>cluster 4: low income, more education</p></li>
</ul>
<p>From there, we can look at other attributes of those clusters.</p>
<p>This approach is commonly used in demographic analysis where many attributes are considered to create discrete clusters.</p>
<p>A good example of this used in practice is Environics Analytics PRIZM Segmentation:</p>
<p><a class="reference external" href="https://environicsanalytics.com/en-ca/data/segmentation">https://environicsanalytics.com/en-ca/data/segmentation</a></p>
<p><img alt="example of different segments" src="https://environicsanalytics.com/images/default-source/product-pages/page-content/prizm-page-illustrations-cards.png" /></p>
<p><a class="reference external" href="https://prizm.environicsanalytics.com/?_ga=2.84764121.114697395.1648300904-78433696.1648300904">You can look up what ‘demographic segment’ or cluster your postal code belongs to here!</a></p>
<section id="spatial-clustering-at-a-high-level-is-doing-the-same-thing-but-one-attribute-to-consider-is-geography">
<h3>Spatial clustering, at a high level, is doing the same thing but one attribute to consider is geography.<a class="headerlink" href="#spatial-clustering-at-a-high-level-is-doing-the-same-thing-but-one-attribute-to-consider-is-geography" title="Link to this heading">#</a></h3>
<p>Spatial clustering involves looking at:</p>
<ul class="simple">
<li><p>how some attribute is expressed across space;</p></li>
<li><p>whether similar attribute values are near each other.</p></li>
</ul>
<section id="if-we-want-to-do-spatial-clustering-of-a-variable-what-two-pieces-of-information-do-we-need-don-t-over-think">
<h4>If we want to do ‘spatial clustering’ of a variable what two pieces of information do we need? (don’t over think!!!)<a class="headerlink" href="#if-we-want-to-do-spatial-clustering-of-a-variable-what-two-pieces-of-information-do-we-need-don-t-over-think" title="Link to this heading">#</a></h4>
</section>
</section>
</section>
<section id="autocorrelation">
<h2>Autocorrelation<a class="headerlink" href="#autocorrelation" title="Link to this heading">#</a></h2>
<p>Autocorrelation literally means ‘self correlations’.</p>
<p>So instead of looking at how two attributes relate to each other (e.g., regression), we want to explore one a single attribute relates to its neighbours.</p>
<p>Typically, we’re talking about temporal autocorrelation or spatial autocorrelation.</p>
</section>
<section id="spatial-autocorrelation">
<h2>Spatial Autocorrelation<a class="headerlink" href="#spatial-autocorrelation" title="Link to this heading">#</a></h2>
<p>How does a variable value in a specific location correlate with the variable values in its neighbours?</p>
<ul class="simple">
<li><p>regress a value on the values of its neighbours!</p></li>
</ul>
<section id="so-again-information-do-we-need-to-do-answer-this-question">
<h3>So again, information do we need to do answer this question?<a class="headerlink" href="#so-again-information-do-we-need-to-do-answer-this-question" title="Link to this heading">#</a></h3>
</section>
<section id="for-each-observation-in-this-case-neighborhood-we-need-to-know-their-neighbours">
<h3>1) For each observation (in this case, neighborhood) we need to know their neighbours!<a class="headerlink" href="#for-each-observation-in-this-case-neighborhood-we-need-to-know-their-neighbours" title="Link to this heading">#</a></h3>
<p>To do this we can create something known as a ‘weights matrix’.</p>
<p>A weights matrix is a matrix that describes whether or not any one observation is ‘neighbours’ with another.</p>
<p>There are many ways we can do this, but let’s focus on two common ones: queens contiguity matrix and the rook contiguity matrix:</p>
<p><img alt="weights matrices" src="https://i.stack.imgur.com/CWIHi.jpg" /></p>
</section>
<section id="next-we-need-to-describe-the-value-of-our-attribute-of-interest-in-neighbours">
<h3>2) Next we need to describe the value of our attribute of interest in neighbours<a class="headerlink" href="#next-we-need-to-describe-the-value-of-our-attribute-of-interest-in-neighbours" title="Link to this heading">#</a></h3>
<p>To do this we create a variable known as ‘spatial lag’.</p>
<p>Spatial lag for neighbourhood <em>i</em> is often just the average of some attribute value across all of neighbourhood <em>i</em>’s neighbours (as determined by our weights matrix!).</p>
</section>
<section id="finally-now-we-can-see-how-a-neighbourhood-s-attribute-compares-to-its-neighbours">
<h3>3) Finally, now we can see how a neighbourhood’s attribute compares to its neighbours.<a class="headerlink" href="#finally-now-we-can-see-how-a-neighbourhood-s-attribute-compares-to-its-neighbours" title="Link to this heading">#</a></h3>
<p>This set up allows us to see if neighbourhood’s with high attribute values are next to other neighbourhoods with high values.</p>
<p>We can then use a number of statistical tests to determine if there are ‘significant’ clusters in our dataset.</p>
</section>
<section id="we-will-talk-about-the-code-to-show-how-this-works-next-week">
<h3>We will talk about the code to show how this works next week.<a class="headerlink" href="#we-will-talk-about-the-code-to-show-how-this-works-next-week" title="Link to this heading">#</a></h3>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./weekly-materials/week11/lecture"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../../week10/homework/Homework_10.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Homework 10 : Linear Regression</p>
      </div>
    </a>
    <a class="right-next"
       href="../lab/Lab_11.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">GGR274 Lab 11: Data analysis and result presentation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Class 11</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mar-26-2024">Mar. 26, 2024</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#a-review-of-spatial-data-and-mapping">A review of spatial data and mapping</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-bring-in-the-same-files-we-worked-with-last-week">Let’s bring in the same files we worked with last week</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-geopandas-to-load-in-spatial-data">1. Using GeoPandas to load in spatial data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simplify-the-geodataframe">2. Simplify the geodataframe</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-health-information-and-simplify-it">3. Import health information and simplify it</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#join-our-neighbourhood-gdf-with-our-asthma-rate-df">4. Join our neighbourhood gdf with our asthma rate df:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#map-the-attribute-data-asthma">5. Map the attribute data (asthma)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pop-quiz">POP QUIZ!!</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#more-on-cartography">More on Cartography</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-this-point-we-have-used-quantiles-to-classify-values-in-maps">To this point we have used quantiles to classify values in maps.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-other-common-options-do-we-have-see-the-document-of-geodataframe-plot-and-mapclassify">What other common options do we have?  See the document of GeoDataFrame.plot and mapclassify</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-a-background">Adding a background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-reproject-the-map-into-web-mercator-and-compare-to-the-original-projection">Let’s reproject the map into Web Mercator and compare to the original projection:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-add-the-web-basemap-we-can-do-the-following">To add the web basemap, we can do the following</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-else-we-can-visualize-the-data-analysis-results-together">What else? We can visualize the data analysis results together!</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-in-the-immigration-data">1. load in the immigration data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-dataset">2. Merge dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conduct-linear-regression">3. conduct linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-results">4. Visualize the results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-clustering">Introduction to clustering</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-clustering">What is clustering?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-want-to-identify-clusters">Why do we want to identify clusters?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-clustering-at-a-high-level-is-doing-the-same-thing-but-one-attribute-to-consider-is-geography">Spatial clustering, at a high level, is doing the same thing but one attribute to consider is geography.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#if-we-want-to-do-spatial-clustering-of-a-variable-what-two-pieces-of-information-do-we-need-don-t-over-think">If we want to do ‘spatial clustering’ of a variable what two pieces of information do we need? (don’t over think!!!)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelation">Autocorrelation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-autocorrelation">Spatial Autocorrelation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#so-again-information-do-we-need-to-do-answer-this-question">So again, information do we need to do answer this question?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-each-observation-in-this-case-neighborhood-we-need-to-know-their-neighbours">1) For each observation (in this case, neighborhood) we need to know their neighbours!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#next-we-need-to-describe-the-value-of-our-attribute-of-interest-in-neighbours">2) Next we need to describe the value of our attribute of interest in neighbours</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finally-now-we-can-see-how-a-neighbourhood-s-attribute-compares-to-its-neighbours">3) Finally, now we can see how a neighbourhood’s attribute compares to its neighbours.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#we-will-talk-about-the-code-to-show-how-this-works-next-week">We will talk about the code to show how this works next week.</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By GGR274 Instructors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>